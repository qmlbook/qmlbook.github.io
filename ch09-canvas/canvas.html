<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>9. Canvas Element &#8212; Qt5 Cadaques Book vmaster</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom-styles.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="10. Particle Simulations" href="../ch10-particles/particles.html" />
    <link rel="prev" title="8. Felgo" href="../ch08-felgo/felgo.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          QmlBook</a>
        <span class="navbar-text navbar-version pull-left"><b>master</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Chapters <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ch01-meetqt/meetqt.html">1. Meet Qt 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch02-start/start.html">2. Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch03-qtcreator/qtcreator.html">3. Qt Creator IDE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch04-qmlstart/qmlstart.html">4. Quick Starter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch05-fluid/fluid.html">5. Fluid Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch06-controls/controls.html">6. Qt Quick Controls 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch07-modelview/modelview.html">7. Model-View-Delegate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch08-felgo/felgo.html">8. Felgo</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">9. Canvas Element</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch10-particles/particles.html">10. Particle Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch11-shaders/shaders.html">11. Shader Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch12-multimedia/multimedia.html">12. Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch13-networking/networking.html">13. Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch14-storage/storage.html">14. Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch15-dynamicqml/dynamicqml.html">15. Dynamic QML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch16-javascript/javascript.html">16. JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch17-qtcpp/qtcpp.html">17. Qt and C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch18-extensions/extensions.html">18. Extending QML with C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch19-felgo-plugins/felgo-plugins.html">19. Felgo Plugins and QML Hot Reloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch20-python/python.html">20. Qt for Python</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/testing.html">1. Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment/deployment.html">2. Deploying QML Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../draganddrop/draganddrop.html">3. Drag and Drop</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">9. Canvas Element</a><ul>
<li><a class="reference internal" href="#convenient-api">9.1. Convenient API</a></li>
<li><a class="reference internal" href="#gradients">9.2. Gradients</a></li>
<li><a class="reference internal" href="#shadows">9.3. Shadows</a></li>
<li><a class="reference internal" href="#images">9.4. Images</a></li>
<li><a class="reference internal" href="#transformation">9.5. Transformation</a></li>
<li><a class="reference internal" href="#composition-modes">9.6. Composition Modes</a></li>
<li><a class="reference internal" href="#pixel-buffers">9.7. Pixel Buffers</a></li>
<li><a class="reference internal" href="#canvas-paint">9.8. Canvas Paint</a></li>
<li><a class="reference internal" href="#porting-from-html5-canvas">9.9. Porting from HTML5 Canvas</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../ch08-felgo/felgo.html" title="Previous Chapter: 8. Felgo"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 8. Felgo</span>
    </a>
  </li>
  <li>
    <a href="../ch10-particles/particles.html" title="Next Chapter: 10. Particle Simulations"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">10. Particle ... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">9. Canvas Element</a><ul>
<li><a class="reference internal" href="#convenient-api">9.1. Convenient API</a></li>
<li><a class="reference internal" href="#gradients">9.2. Gradients</a></li>
<li><a class="reference internal" href="#shadows">9.3. Shadows</a></li>
<li><a class="reference internal" href="#images">9.4. Images</a></li>
<li><a class="reference internal" href="#transformation">9.5. Transformation</a></li>
<li><a class="reference internal" href="#composition-modes">9.6. Composition Modes</a></li>
<li><a class="reference internal" href="#pixel-buffers">9.7. Pixel Buffers</a></li>
<li><a class="reference internal" href="#canvas-paint">9.8. Canvas Paint</a></li>
<li><a class="reference internal" href="#porting-from-html5-canvas">9.9. Porting from HTML5 Canvas</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <div class="section" id="canvas-element">
<h1>9. Canvas Element<a class="headerlink" href="#canvas-element" title="Permalink to this headline">¶</a></h1>
<p><em>Section author: <a class="reference external" href="https://www.linkedin.com/in/jryannel">jryannel&#64;LinkedIn</a></em></p>
<p><div class="btn-group btn-group-justified" role="group"><a class="btn btn-primary btn-xs" href="https://github.com/qmlbook/qmlbook/" target="_blank">Github</a><a class="btn btn-primary btn-xs" href="https://github.com/qmlbook/qmlbook//blob/master/docs/ch09-canvas/canvas.rst" target="_blank"><i class="glyphicon glyphicon-file"></i> View</a><a class="btn btn-primary btn-xs" href="https://github.com/qmlbook/qmlbook//edit/master/docs/ch09-canvas/canvas.rst" target="_blank"><i class="glyphicon glyphicon-pencil"></i> Edit</a><a class="btn btn-primary btn-xs" href="https://github.com/qmlbook/qmlbook//issues/new?labels=ch09&body=back-link%3A+ch09-canvas%2Fcanvas.html%23canvas-element" target="_blank"><i class="glyphicon glyphicon-plus"></i> Issue </a><a  class="btn btn-primary btn-xs" href="https://github.com/qmlbook/qmlbook//issues?labels=ch09&page=1&state=open" target="_blank"><i class="glyphicon glyphicon-search"></i> Issues</a></div></p><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Last Build: November 10, 2020 at 08:11 CET</p>
<p class="last">The source code for this chapter can be found in the <a class="reference external" href="../assets">assets folder</a>.</p>
</div>
<div class="figure">
<img alt="../_images/glowlines.png" src="../_images/glowlines.png" />
</div>
<p>Early on when QML was introduced in Qt4 there were some discussions about if Qt Quick needs an ellipse. The problem with the ellipse is that others can argue other shapes need also be supported. So there is no ellipse in Qt Quick only rectangular shapes. If you needed one in Qt4 you would need to use an image or write your own C++ ellipse element.</p>
<p>To allow scripted drawings Qt 5 introduces the canvas element. The canvas elements provide a resolution-dependent bitmap canvas, which can be used for graphics, games or to paint other visual images on the fly using JavaScript. The canvas element is based on the HTML5 canvas element.</p>
<p>The fundamental idea of the canvas element is to render paths using a context 2D object. The context 2D object, contains the necessary graphics functions, whereas the canvas acts as the drawing canvas. The 2D context supports strokes, fills gradients, text and a different set of path creation commands.</p>
<p>Let’s see an example of a simple path drawing:</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">2.5</span>

<span class="nx">Canvas</span> <span class="p">{</span>
    <span class="kd">id: root</span>
    <span class="c1">// canvas size</span>
    <span class="k">width:</span> <span class="mi">200</span><span class="p">;</span> <span class="k">height:</span> <span class="mi">200</span>
    <span class="c1">// handler to override for drawing</span>
    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="c1">// get context to draw with</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
        <span class="c1">// setup the stroke</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
        <span class="c1">// setup the fill</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;steelblue&quot;</span>
        <span class="c1">// begin a new path to draw</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="c1">// top-left start point</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
        <span class="c1">// upper line</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
        <span class="c1">// right line</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>
        <span class="c1">// bottom line</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>
        <span class="c1">// left line through path closing</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
        <span class="c1">// fill using fill style</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
        <span class="c1">// stroke using line width and stroke style</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This produces a filled rectangle with a starting point at 50,50 and a size of 100 and a stroke used as a border decoration.</p>
<div class="figure">
<img alt="../_images/rectangle.png" src="../_images/rectangle.png" />
</div>
<p>The stroke width is set to 4 and uses a blue color define by <code class="docutils literal notranslate"><span class="pre">strokeStyle</span></code>. The final shape is set up to be filled through the <code class="docutils literal notranslate"><span class="pre">fillStyle</span></code> to a “steel blue” color. Only by calling <code class="docutils literal notranslate"><span class="pre">stroke</span></code> or <code class="docutils literal notranslate"><span class="pre">fill</span></code> the actual path will be drawn and they can be used independently from each other. A call to <code class="docutils literal notranslate"><span class="pre">stroke</span></code> or <code class="docutils literal notranslate"><span class="pre">fill</span></code> will draw the current path. It’s not possible to store a path for later reuse only a drawing state can be stored and restored.</p>
<p>In QML the <code class="docutils literal notranslate"><span class="pre">Canvas</span></code> element acts as a container for the drawing. The 2D context object provides the actual drawing operation. The actual drawing needs to be done inside the <code class="docutils literal notranslate"><span class="pre">onPaint</span></code> event handler.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Canvas</span> <span class="p">{</span>
    <span class="nx">width</span><span class="o">:</span> <span class="mf">200</span><span class="p">;</span> <span class="nx">height</span><span class="o">:</span> <span class="mf">200</span>
    <span class="nx">onPaint</span><span class="o">:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
        <span class="c1">// setup your path</span>
        <span class="c1">// fill or/and stroke</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The canvas itself provides a typical two-dimensional Cartesian coordinate system, where the top-left is the (0,0) point. A higher y-value goes down and a hight x-value goes to the right.</p>
<p>A typical order of commands for this path based API is the following:</p>
<ol class="arabic simple">
<li>Setup stroke and/or fill</li>
<li>Create path</li>
<li>Stroke and/or fill</li>
</ol>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span>    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>

        <span class="c1">// setup the stroke</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>

        <span class="c1">// create a path</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>

        <span class="c1">// stroke path</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>This produces a horizontal stroked line from point <code class="docutils literal notranslate"><span class="pre">P1(50,50)</span></code> to point <code class="docutils literal notranslate"><span class="pre">P2(150,50)</span></code>.</p>
<div class="figure">
<img alt="../_images/line.png" src="../_images/line.png" />
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Typically you always want to set a start point when you reset your path, so the first operation after <code class="docutils literal notranslate"><span class="pre">beginPath</span></code> is often <code class="docutils literal notranslate"><span class="pre">moveTo</span></code>.</p>
</div>
<div class="section" id="convenient-api">
<h2>9.1. Convenient API<a class="headerlink" href="#convenient-api" title="Permalink to this headline">¶</a></h2>
<p><div class="btn-group" role="group"><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook//new?labels=ch07&body=back-link%3A+ch09-canvas%2Fcanvas.html%23convenient-api"><i class="glyphicon glyphicon-plus"></i> Issue</a><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook/?labels=ch07&page=1&state=open"><i class="glyphicon glyphicon-search"></i> Issues</a></div></p><p>For operations on rectangles, a convenience API is provided which draws directly and does need a stroke or fill call.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="c1">// convenient.qml</span>

<span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">2.5</span>

<span class="nx">Canvas</span> <span class="p">{</span>
    <span class="kd">id: root</span>
    <span class="k">width:</span> <span class="mi">120</span><span class="p">;</span> <span class="k">height:</span> <span class="mi">120</span>
    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="c1">// draw a filles rectangle</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
        <span class="c1">// cut our an inner rectangle</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="c1">// stroke a border from top-left to</span>
        <span class="c1">// inner center of the larger rectangle</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeRect</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="figure">
<img alt="../_images/convenient.png" src="../_images/convenient.png" />
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The stroke area extends half of the line width on both sides of the path. A 4 px lineWidth will draw 2 px outside the path and 2 px inside.</p>
</div>
</div>
<div class="section" id="gradients">
<h2>9.2. Gradients<a class="headerlink" href="#gradients" title="Permalink to this headline">¶</a></h2>
<p><div class="btn-group" role="group"><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook//new?labels=ch07&body=back-link%3A+ch09-canvas%2Fcanvas.html%23gradients"><i class="glyphicon glyphicon-plus"></i> Issue</a><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook/?labels=ch07&page=1&state=open"><i class="glyphicon glyphicon-search"></i> Issues</a></div></p><p>Canvas can fill shapes with color but also with gradients or images.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span>    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>

        <span class="kd">var</span> <span class="nx">gradient</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
        <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;lightsteelblue&quot;</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">gradient</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The gradient in this example is defined along the starting point (100,0) to the end point (100,200), which gives a vertical line in the middle of our canvas. The gradient-stops can be defined as a color from 0.0 (gradient start point) to 1.0 (gradient endpoint). Here we use a “blue” color at 0.0 (100,0) and a “lightsteelblue” color at the 0.5 (100,200) position. The gradient is defined as much larger than the rectangle we want to draw, so the rectangle clips gradient to it’s defined the geometry.</p>
<div class="figure">
<img alt="../_images/gradient.png" src="../_images/gradient.png" />
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The gradient is defined in canvas coordinates not in coordinates relative to the path to be painted. A canvas does not have the concept of relative coordinates, as we are used to by now from QML.</p>
</div>
</div>
<div class="section" id="shadows">
<h2>9.3. Shadows<a class="headerlink" href="#shadows" title="Permalink to this headline">¶</a></h2>
<p><div class="btn-group" role="group"><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook//new?labels=ch07&body=back-link%3A+ch09-canvas%2Fcanvas.html%23shadows"><i class="glyphicon glyphicon-plus"></i> Issue</a><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook/?labels=ch07&page=1&state=open"><i class="glyphicon glyphicon-search"></i> Issues</a></div></p><p>A path can be visually enhanced using shadows with the 2D context object. A shadow is an area around the path with an offset, color and specified blurring. For this you can specify a <code class="docutils literal notranslate"><span class="pre">shadowColor</span></code>, <code class="docutils literal notranslate"><span class="pre">shadowOffsetX</span></code>, <code class="docutils literal notranslate"><span class="pre">shadowOffsetY</span></code> and a <code class="docutils literal notranslate"><span class="pre">shadowBlur</span></code>. All of this needs to be defined using the 2D context. The 2D context is your only API to the drawing operations.</p>
<p>A shadow can also be used to create a glow effect around a path. In the next example, we create a text “Canvas” with a white glow around. All this on a dark background for better visibility.</p>
<p>First, we draw the dark background:</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span>        <span class="c1">// setup a dark background</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;#333&quot;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
</pre></div>
</div>
<p>then we define our shadow configuration, which will be used for the next path:</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span>        <span class="c1">// setup a blue shadow</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">shadowColor</span> <span class="o">=</span> <span class="s2">&quot;#2ed5fa&quot;</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">shadowOffsetX</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">shadowOffsetY</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">shadowBlur</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<p>Finally, we draw our “Canvas” text using a large bold 80px font from the <em>Ubuntu</em> font family.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span>        <span class="c1">// render green text</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="s1">&#39;bold 80px Ubuntu&#39;</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;#24d12e&quot;</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s2">&quot;Canvas!&quot;</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">180</span><span class="p">);</span>
</pre></div>
</div>
<div class="figure">
<img alt="../_images/shadow.png" src="../_images/shadow.png" />
</div>
</div>
<div class="section" id="images">
<h2>9.4. Images<a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h2>
<p><div class="btn-group" role="group"><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook//new?labels=ch07&body=back-link%3A+ch09-canvas%2Fcanvas.html%23images"><i class="glyphicon glyphicon-plus"></i> Issue</a><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook/?labels=ch07&page=1&state=open"><i class="glyphicon glyphicon-search"></i> Issues</a></div></p><p>The QML canvas supports image drawing from several sources. To use an image inside the canvas the image needs to be loaded first. We will use the <code class="docutils literal notranslate"><span class="pre">Component.onCompleted</span></code> handler to load the image in our example.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span>    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>


        <span class="c1">// draw an image</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="s1">&#39;assets/ball.png&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="c1">// store current context setup</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s1">&#39;#ff2a68&#39;</span>
        <span class="c1">// create a triangle as clip region</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">155</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">135</span><span class="p">,</span><span class="mi">55</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
        <span class="c1">// translate coordinate system</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">clip</span><span class="p">()</span>  <span class="c1">// create clip from the path</span>
        <span class="c1">// draw image with clip applied</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="s1">&#39;assets/ball.png&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="c1">// draw stroke around path</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
        <span class="c1">// restore previous context</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>

    <span class="p">}</span>

    <span class="k">Component.onCompleted:</span> <span class="p">{</span>
        <span class="nx">loadImage</span><span class="p">(</span><span class="s2">&quot;assets/ball.png&quot;</span><span class="p">)</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The left shows our ball image painted at the top-left position of 10x10. The right image shows the ball with a clipping path applied. Images and any other path can be clipped using another path. The clipping is applied by defining a path and calling the <code class="docutils literal notranslate"><span class="pre">clip()</span></code> function. All following drawing operations will now be clipped by this path. The clipping is disabled again by restoring the previous state or by setting the clip region to the whole canvas.</p>
<div class="figure">
<img alt="../_images/canvas_image.png" src="../_images/canvas_image.png" />
</div>
</div>
<div class="section" id="transformation">
<h2>9.5. Transformation<a class="headerlink" href="#transformation" title="Permalink to this headline">¶</a></h2>
<p><div class="btn-group" role="group"><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook//new?labels=ch07&body=back-link%3A+ch09-canvas%2Fcanvas.html%23transformation"><i class="glyphicon glyphicon-plus"></i> Issue</a><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook/?labels=ch07&page=1&state=open"><i class="glyphicon glyphicon-search"></i> Issues</a></div></p><p>The canvas allows you to transform the coordinate system in several ways. This is very similar to the transformation offered by QML items. You have the possibility to <code class="docutils literal notranslate"><span class="pre">scale</span></code>, <code class="docutils literal notranslate"><span class="pre">rotate</span></code>, <code class="docutils literal notranslate"><span class="pre">translate</span></code> the coordinate system. Indifference to QML the transform origin is always the canvas origin. For example to scale a path around its center you would need to translate the canvas origin to the center of the path. It is also possible to apply a more complex transformation using the transform method.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="c1">// transform.qml</span>

<span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">2.5</span>

<span class="nx">Canvas</span> <span class="p">{</span>
    <span class="kd">id: root</span>
    <span class="k">width:</span> <span class="mi">240</span><span class="p">;</span> <span class="k">height:</span> <span class="mi">120</span>
    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
            <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">;</span>

            <span class="c1">// translate x/y coordinate system</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nx">root</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>

            <span class="c1">// draw path</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>

            <span class="c1">// rotate coordinate system</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>

            <span class="c1">// draw path</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="figure">
<img alt="../_images/transform.png" src="../_images/transform.png" />
</div>
<p>Besides translate the canvas allows also to scale using <code class="docutils literal notranslate"><span class="pre">scale(x,y)</span></code> around x and y-axis, to rotate using <code class="docutils literal notranslate"><span class="pre">rotate(angle)</span></code>, where the angle is given in radius (<em>360 degree = 2*Math.PI</em>) and to use a matrix transformation using the <code class="docutils literal notranslate"><span class="pre">setTransform(m11,</span> <span class="pre">m12,</span> <span class="pre">m21,</span> <span class="pre">m22,</span> <span class="pre">dx,</span> <span class="pre">dy)</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To reset any transformation you can call the <code class="docutils literal notranslate"><span class="pre">resetTransform()</span></code> function to set the transformation matrix back to the identity matrix:</p>
<div class="last highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="nx">ctx</span><span class="p">.</span><span class="nx">resetTransform</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="composition-modes">
<h2>9.6. Composition Modes<a class="headerlink" href="#composition-modes" title="Permalink to this headline">¶</a></h2>
<p><div class="btn-group" role="group"><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook//new?labels=ch07&body=back-link%3A+ch09-canvas%2Fcanvas.html%23composition-modes"><i class="glyphicon glyphicon-plus"></i> Issue</a><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook/?labels=ch07&page=1&state=open"><i class="glyphicon glyphicon-search"></i> Issues</a></div></p><p>Composition allows you to draw a shape and blend it with the existing pixels. The canvas supports several composition modes using the <code class="docutils literal notranslate"><span class="pre">globalCompositeOperation(mode)</span></code> operation.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">source-over</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">source-in</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">source-out</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">source-atop</span></code></li>
</ul>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span>    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">globalCompositeOperation</span> <span class="o">=</span> <span class="s2">&quot;xor&quot;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;#33a9ff&quot;</span>

        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">40</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">400</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">200</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>This little examples iterates over a list of composite modes and generates a rectangle with a circle.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span>    <span class="nx">property</span> <span class="kd">var</span> <span class="k">operation :</span> <span class="p">[</span>
        <span class="s1">&#39;source-over&#39;</span><span class="p">,</span> <span class="s1">&#39;source-in&#39;</span><span class="p">,</span> <span class="s1">&#39;source-over&#39;</span><span class="p">,</span>
        <span class="s1">&#39;source-atop&#39;</span><span class="p">,</span> <span class="s1">&#39;destination-over&#39;</span><span class="p">,</span> <span class="s1">&#39;destination-in&#39;</span><span class="p">,</span>
        <span class="s1">&#39;destination-out&#39;</span><span class="p">,</span> <span class="s1">&#39;destination-atop&#39;</span><span class="p">,</span> <span class="s1">&#39;lighter&#39;</span><span class="p">,</span>
        <span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="s1">&#39;xor&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-clear&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-destination&#39;</span><span class="p">,</span>
        <span class="s1">&#39;qt-multiply&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-screen&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-overlay&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-darken&#39;</span><span class="p">,</span>
        <span class="s1">&#39;qt-lighten&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-color-dodge&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-color-burn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;qt-hard-light&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-soft-light&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-difference&#39;</span><span class="p">,</span>
        <span class="s1">&#39;qt-exclusion&#39;</span>
        <span class="p">]</span>

    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">)</span>

        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">operation</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">i</span><span class="o">%</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
            <span class="kd">var</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">i</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">&#39;#33a9ff&#39;</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">10</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span><span class="mi">10</span><span class="o">+</span><span class="nx">dy</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
            <span class="c1">// TODO: does not work yet</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">globalCompositeOperation</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">operation</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">&#39;#ff33a9&#39;</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="mf">0.75</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="mi">60</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="mi">60</span><span class="o">+</span><span class="nx">dy</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="pixel-buffers">
<h2>9.7. Pixel Buffers<a class="headerlink" href="#pixel-buffers" title="Permalink to this headline">¶</a></h2>
<p><div class="btn-group" role="group"><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook//new?labels=ch07&body=back-link%3A+ch09-canvas%2Fcanvas.html%23pixel-buffers"><i class="glyphicon glyphicon-plus"></i> Issue</a><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook/?labels=ch07&page=1&state=open"><i class="glyphicon glyphicon-search"></i> Issues</a></div></p><p>When working with the canvas you are able to retrieve pixel data from the canvas to read or manipulate the pixels of your canvas. To read the image data use <code class="docutils literal notranslate"><span class="pre">createImageData(sw,sh)</span></code> or <code class="docutils literal notranslate"><span class="pre">getImageData(sx,sy,sw,sh)</span></code>. Both functions return an <code class="docutils literal notranslate"><span class="pre">ImageData</span></code> object with a <code class="docutils literal notranslate"><span class="pre">width</span></code>, <code class="docutils literal notranslate"><span class="pre">height</span></code> and a <code class="docutils literal notranslate"><span class="pre">data</span></code> variable. The data variable contains a one-dimensional array of the pixel data retrieved in the <em>RGBA</em> format, where each value varies in the range of 0 to 255. To set pixels on the canvas you can use the <code class="docutils literal notranslate"><span class="pre">putImageData(imagedata,</span> <span class="pre">dx,</span> <span class="pre">dy)</span></code> function.</p>
<p>Another way to retrieve the content of the canvas is to store the data into an image. This can be achieved with the <code class="docutils literal notranslate"><span class="pre">Canvas</span></code> functions <code class="docutils literal notranslate"><span class="pre">save(path)</span></code> or <code class="docutils literal notranslate"><span class="pre">toDataURL(mimeType)</span></code>, where the later function returns an image URL, which can be used to be loaded by an <code class="docutils literal notranslate"><span class="pre">Image</span></code> element.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">2.5</span>

<span class="nx">Rectangle</span> <span class="p">{</span>
    <span class="k">width:</span> <span class="mi">240</span><span class="p">;</span> <span class="k">height:</span> <span class="mi">120</span>
    <span class="nx">Canvas</span> <span class="p">{</span>
        <span class="kd">id: canvas</span>
        <span class="k">x:</span> <span class="mi">10</span><span class="p">;</span> <span class="k">y:</span> <span class="mi">10</span>
        <span class="k">width:</span> <span class="mi">100</span><span class="p">;</span> <span class="k">height:</span> <span class="mi">100</span>
        <span class="nx">property</span> <span class="nx">real</span> <span class="k">hue:</span> <span class="mf">0.0</span>
        <span class="k">onPaint:</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
            <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span>
            <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span>
            <span class="nx">hue</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mf">0.1</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">hue</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">hue</span> <span class="o">-=</span> <span class="mi">1</span> <span class="p">}</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="mf">0.7</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">hsla</span><span class="p">(</span><span class="nx">hue</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span> <span class="nx">x</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nx">MouseArea</span> <span class="p">{</span>
            <span class="k">anchors.fill:</span> <span class="nx">parent</span>
            <span class="k">onClicked:</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(</span><span class="s1">&#39;image/png&#39;</span><span class="p">)</span>
                <span class="nx">print</span><span class="p">(</span><span class="s1">&#39;image url=&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
                <span class="nx">image</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nx">url</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">Image</span> <span class="p">{</span>
        <span class="kd">id: image</span>
        <span class="k">x:</span> <span class="mi">130</span><span class="p">;</span> <span class="k">y:</span> <span class="mi">10</span>
        <span class="k">width:</span> <span class="mi">100</span><span class="p">;</span> <span class="k">height:</span> <span class="mi">100</span>
    <span class="p">}</span>

    <span class="nx">Timer</span> <span class="p">{</span>
        <span class="k">interval:</span> <span class="mi">1000</span>
        <span class="k">running:</span> <span class="kc">true</span>
        <span class="k">triggeredOnStart:</span> <span class="kc">true</span>
        <span class="k">repeat:</span> <span class="kc">true</span>
        <span class="k">onTriggered:</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">requestPaint</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In our little example, we paint every second a small circle on the left canvas. When the user clicks on the mouse area the canvas content is stored and an image URL is retrieved. On the right side of our example, the image is then displayed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Retrieving image data seems not to work currently in the Qt 5 Alpha SDK.</p>
</div>
</div>
<div class="section" id="canvas-paint">
<h2>9.8. Canvas Paint<a class="headerlink" href="#canvas-paint" title="Permalink to this headline">¶</a></h2>
<p><div class="btn-group" role="group"><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook//new?labels=ch07&body=back-link%3A+ch09-canvas%2Fcanvas.html%23canvas-paint"><i class="glyphicon glyphicon-plus"></i> Issue</a><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook/?labels=ch07&page=1&state=open"><i class="glyphicon glyphicon-search"></i> Issues</a></div></p><p>In this example, we would like to create a small paint application using the <code class="docutils literal notranslate"><span class="pre">Canvas</span></code> element.</p>
<div class="figure">
<img alt="../_images/canvaspaint.png" src="../_images/canvaspaint.png" />
</div>
<p>For this, we arrange four color squares on the top of our scene using a row positioner. A color square is a simple rectangle filled with a mouse area to detect clicks.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span>    <span class="nx">Row</span> <span class="p">{</span>
        <span class="kd">id: colorTools</span>
        <span class="nx">anchors</span> <span class="p">{</span>
            <span class="k">horizontalCenter:</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">horizontalCenter</span>
            <span class="k">top:</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">top</span>
            <span class="k">topMargin:</span> <span class="mi">8</span>
        <span class="p">}</span>
        <span class="nx">property</span> <span class="nx">variant</span> <span class="k">activeSquare:</span> <span class="nx">red</span>
        <span class="nx">property</span> <span class="nx">color</span> <span class="k">paintColor:</span> <span class="s2">&quot;#33B5E5&quot;</span>
        <span class="k">spacing:</span> <span class="mi">4</span>
        <span class="nx">Repeater</span> <span class="p">{</span>
            <span class="k">model:</span> <span class="p">[</span><span class="s2">&quot;#33B5E5&quot;</span><span class="p">,</span> <span class="s2">&quot;#99CC00&quot;</span><span class="p">,</span> <span class="s2">&quot;#FFBB33&quot;</span><span class="p">,</span> <span class="s2">&quot;#FF4444&quot;</span><span class="p">]</span>
            <span class="nx">ColorSquare</span> <span class="p">{</span>
                <span class="kd">id: red</span>
                <span class="k">color:</span> <span class="nx">modelData</span>
                <span class="k">active:</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">paintColor</span> <span class="o">==</span> <span class="nx">color</span>
                <span class="k">onClicked:</span> <span class="p">{</span>
                    <span class="nx">parent</span><span class="p">.</span><span class="nx">paintColor</span> <span class="o">=</span> <span class="nx">color</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The colors are stored in an array and the paint color. When one the user clicks in one of the squares the color of the square is assigned to the <code class="docutils literal notranslate"><span class="pre">paintColor</span></code> property of the row named <em>colorTools</em>.</p>
<p>To enable tracking of the mouse events on the canvas we have a <code class="docutils literal notranslate"><span class="pre">MouseArea</span></code> covering the canvas element and hooked up the pressed and position changed handlers.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span>    <span class="nx">Canvas</span> <span class="p">{</span>
        <span class="kd">id: canvas</span>
        <span class="nx">anchors</span> <span class="p">{</span>
            <span class="k">left:</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">left</span>
            <span class="k">right:</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">right</span>
            <span class="k">top:</span> <span class="nx">colorTools</span><span class="p">.</span><span class="nx">bottom</span>
            <span class="k">bottom:</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">bottom</span>
            <span class="k">margins:</span> <span class="mi">8</span>
        <span class="p">}</span>
        <span class="nx">property</span> <span class="nx">real</span> <span class="nx">lastX</span>
        <span class="nx">property</span> <span class="nx">real</span> <span class="nx">lastY</span>
        <span class="nx">property</span> <span class="nx">color</span> <span class="k">color:</span> <span class="nx">colorTools</span><span class="p">.</span><span class="nx">paintColor</span>

        <span class="k">onPaint:</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">)</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mf">1.5</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">color</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">lastX</span><span class="p">,</span> <span class="nx">lastY</span><span class="p">)</span>
            <span class="nx">lastX</span> <span class="o">=</span> <span class="nx">area</span><span class="p">.</span><span class="nx">mouseX</span>
            <span class="nx">lastY</span> <span class="o">=</span> <span class="nx">area</span><span class="p">.</span><span class="nx">mouseY</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">lastX</span><span class="p">,</span> <span class="nx">lastY</span><span class="p">)</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nx">MouseArea</span> <span class="p">{</span>
            <span class="kd">id: area</span>
            <span class="k">anchors.fill:</span> <span class="nx">parent</span>
            <span class="k">onPressed:</span> <span class="p">{</span>
                <span class="nx">canvas</span><span class="p">.</span><span class="nx">lastX</span> <span class="o">=</span> <span class="nx">mouseX</span>
                <span class="nx">canvas</span><span class="p">.</span><span class="nx">lastY</span> <span class="o">=</span> <span class="nx">mouseY</span>
            <span class="p">}</span>
            <span class="k">onPositionChanged:</span> <span class="p">{</span>
                <span class="nx">canvas</span><span class="p">.</span><span class="nx">requestPaint</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>A mouse press stores the initial mouse position into the <em>lastX</em> and <em>lastY</em> properties. Every change on the mouse position triggers a paint request on the canvas, which will result in calling the <em>onPaint</em> handler.</p>
<p>To finally draw the users stroke, in the <em>onPaint</em> handler we begin a new path and move to the last position. Then we gather the new position from the mouse area and draw a line with the selected color to the new position. The mouse position is stored as the new <em>last</em> position.</p>
</div>
<div class="section" id="porting-from-html5-canvas">
<h2>9.9. Porting from HTML5 Canvas<a class="headerlink" href="#porting-from-html5-canvas" title="Permalink to this headline">¶</a></h2>
<p><div class="btn-group" role="group"><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook//new?labels=ch07&body=back-link%3A+ch09-canvas%2Fcanvas.html%23porting-from-html5-canvas"><i class="glyphicon glyphicon-plus"></i> Issue</a><a class="btn btn-link btn-xs" href="https://github.com/qmlbook/qmlbook/?labels=ch07&page=1&state=open"><i class="glyphicon glyphicon-search"></i> Issues</a></div></p><ul class="simple">
<li><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations">https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Spirograph">http://en.wikipedia.org/wiki/Spirograph</a></li>
</ul>
<p>It is fairly easy to port an HTML5 canvas graphics over to use the QML canvas. From the thousands of examples, we picked one and tried it yourself.</p>
<p><strong>Spiro Graph</strong></p>
<p>We use a <a class="reference external" href="http://en.wikipedia.org/wiki/Spirograph">spirograph</a> example from the Mozilla project as our foundation. The original HTML5 was posted as part of the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations">canvas tutorial</a>.</p>
<p>There were a few lines we needed to change:</p>
<ul>
<li><p class="first">Qt Quick requires you to declare a variable, so we needed to add some <em>var</em> declarations</p>
<blockquote>
<div><div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="mf">3</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Adapted the draw method to receive the Context2D object</p>
<blockquote>
<div><div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">draw</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">we needed to adapt the translation for each spiro due to different sizes</p>
<blockquote>
<div><div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="mf">20</span><span class="o">+</span><span class="nx">j</span><span class="o">*</span><span class="mf">50</span><span class="p">,</span><span class="mf">20</span><span class="o">+</span><span class="nx">i</span><span class="o">*</span><span class="mf">50</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>Finally, we completed our <code class="docutils literal notranslate"><span class="pre">onPaint</span></code> handler. Inside we acquire a context and call our draw function.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span>    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span>
        <span class="nx">draw</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The result is a ported spiro graph graphics running using the QML canvas</p>
<div class="figure">
<img alt="../_images/spirograph.png" src="../_images/spirograph.png" />
</div>
<p>That’s all.</p>
<p><strong>Glowing Lines</strong></p>
<p>Here is another more complicated port from the W3C organization. The original <a class="reference external" href="http://www.w3.org/TR/2dcontext/#examples">pretty glowing lines</a> has some pretty nice aspects, which makes the porting more challenging.</p>
<div class="figure">
<img alt="../_images/html_glowlines.png" src="../_images/html_glowlines.png" />
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Pretty Glowing Lines<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;canvas</span> <span class="na">width=</span><span class="s">&quot;800&quot;</span> <span class="na">height=</span><span class="s">&quot;450&quot;</span><span class="nt">&gt;&lt;/canvas&gt;</span>
<span class="nt">&lt;script&gt;</span>
var context = document.getElementsByTagName(&#39;canvas&#39;)[0].getContext(&#39;2d&#39;);

// initial start position
var lastX = context.canvas.width * Math.random();
var lastY = context.canvas.height * Math.random();
var hue = 0;

// closure function to draw
// a random bezier curve with random color with a glow effect
function line() {

    context.save();

    // scale with factor 0.9 around the center of canvas
    context.translate(context.canvas.width/2, context.canvas.height/2);
    context.scale(0.9, 0.9);
    context.translate(-context.canvas.width/2, -context.canvas.height/2);

    context.beginPath();
    context.lineWidth = 5 + Math.random() * 10;

    // our start position
    context.moveTo(lastX, lastY);

    // our new end position
    lastX = context.canvas.width * Math.random();
    lastY = context.canvas.height * Math.random();

    // random bezier curve, which ends on lastX, lastY
    context.bezierCurveTo(context.canvas.width * Math.random(),
    context.canvas.height * Math.random(),
    context.canvas.width * Math.random(),
    context.canvas.height * Math.random(),
    lastX, lastY);

    // glow effect
    hue = hue + 10 * Math.random();
    context.strokeStyle = &#39;hsl(&#39; + hue + &#39;, 50%, 50%)&#39;;
    context.shadowColor = &#39;white&#39;;
    context.shadowBlur = 10;
    // stroke the curve
    context.stroke();
    context.restore();
}

// call line function every 50msecs
setInterval(line, 50);

function blank() {
    // makes the background 10% darker on each call
    context.fillStyle = &#39;rgba(0,0,0,0.1)&#39;;
    context.fillRect(0, 0, context.canvas.width, context.canvas.height);
}

// call blank function every 50msecs
setInterval(blank, 40);

<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>In HTML5 the Context2D object can paint at any time on the canvas. In QML it can only point inside the <code class="docutils literal notranslate"><span class="pre">onPaint</span></code> handler. The timer in usage with <code class="docutils literal notranslate"><span class="pre">setInterval</span></code> triggers in HTML5 the stroke of the line or to blank the screen. Due to the different handling in QML, it’s not possible to just call these functions, because we need to go through the <code class="docutils literal notranslate"><span class="pre">onPaint</span></code> handler. Also, the color presentations need to be adapted. Let’s go through the changes on by one.</p>
<p>Everything starts with the canvas element. For simplicity, we just use the <code class="docutils literal notranslate"><span class="pre">Canvas</span></code> element as the root element of our QML file.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">2.5</span>

<span class="nx">Canvas</span> <span class="p">{</span>
   <span class="nx">id</span><span class="o">:</span> <span class="nx">canvas</span>
   <span class="nx">width</span><span class="o">:</span> <span class="mf">800</span><span class="p">;</span> <span class="nx">height</span><span class="o">:</span> <span class="mf">450</span>

   <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To untangle the direct call of the functions through the <code class="docutils literal notranslate"><span class="pre">setInterval</span></code>, we replace the <code class="docutils literal notranslate"><span class="pre">setInterval</span></code> calls with two timers which will request a repaint. A <code class="docutils literal notranslate"><span class="pre">Timer</span></code> is triggered after a short interval and allows us to execute some code. As we can’t tell the paint function which operation we would like to trigger we define for each operation a bool flag request an operation and trigger then a repaint request.</p>
<p>Here is the code for the line operation. The blank operation is similar.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="nx">property</span> <span class="nx">bool</span> <span class="nx">requestLine</span><span class="o">:</span> <span class="kc">false</span>

<span class="nx">Timer</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="nx">lineTimer</span>
    <span class="nx">interval</span><span class="o">:</span> <span class="mf">40</span>
    <span class="nx">repeat</span><span class="o">:</span> <span class="kc">true</span>
    <span class="nx">triggeredOnStart</span><span class="o">:</span> <span class="kc">true</span>
    <span class="nx">onTriggered</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">requestLine</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">requestPaint</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Component</span><span class="p">.</span><span class="nx">onCompleted</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">lineTimer</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>
<span class="p">}</span>
<span class="p">...</span>
</pre></div>
</div>
<p>Now we have an indication which (line or blank or even both) operation we need to perform during the <code class="docutils literal notranslate"><span class="pre">onPaint</span></code> operation. As we enter the <code class="docutils literal notranslate"><span class="pre">onPaint</span></code> handler for each paint request we need to extract the initialization of the variable into the canvas element.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Canvas</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="nx">property</span> <span class="nx">real</span> <span class="nx">hue</span><span class="o">:</span> <span class="mf">0</span>
    <span class="nx">property</span> <span class="nx">real</span> <span class="nx">lastX</span><span class="o">:</span> <span class="nx">width</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
    <span class="nx">property</span> <span class="nx">real</span> <span class="nx">lastY</span><span class="o">:</span> <span class="nx">height</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now our paint function should look like this:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">onPaint</span><span class="o">:</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">requestLine</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">line</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>
        <span class="nx">requestLine</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">requestBlank</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">blank</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>
        <span class="nx">requestBlank</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <em>line</em> function was extracted for a canvas as an argument.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">line</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="mf">2</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mf">2</span><span class="p">);</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">);</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="o">-</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="mf">2</span><span class="p">,</span> <span class="o">-</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mf">2</span><span class="p">);</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mf">5</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mf">10</span><span class="p">;</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">lastX</span><span class="p">,</span> <span class="nx">lastY</span><span class="p">);</span>
    <span class="nx">lastX</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
    <span class="nx">lastY</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">bezierCurveTo</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span>
        <span class="nx">lastX</span><span class="p">,</span> <span class="nx">lastY</span><span class="p">);</span>

    <span class="nx">hue</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mf">0.1</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">hue</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">hue</span> <span class="o">-=</span> <span class="mf">1</span>
    <span class="p">}</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">hsla</span><span class="p">(</span><span class="nx">hue</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
    <span class="c1">// context.shadowColor = &#39;white&#39;;</span>
    <span class="c1">// context.shadowBlur = 10;</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The biggest change was the use of the QML <code class="docutils literal notranslate"><span class="pre">Qt.rgba()</span></code> and <code class="docutils literal notranslate"><span class="pre">Qt.hsla()</span></code> functions, which required to adopt the values to the used 0.0 … 1.0 range in QML.</p>
<p>Same applies to the <em>blank</em> function.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">blank</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">rgba</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The final result will look similar to this.</p>
<div class="figure">
<img alt="../_images/glowlines.png" src="../_images/glowlines.png" />
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="http://www.w3.org/TR/2dcontext/">W3C HTML Canvas 2D Context Specification</a></li>
<li><a class="reference external" href="https://developer.mozilla.org/en/HTML/Canvas">Mozilla Canvas Documentation</a></li>
<li><a class="reference external" href="http://www.html5canvastutorials.com/">HTML5 Canvas Tutorial</a></li>
</ul>
</div>
</div>
</div>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2012-2018 Jürgen Bocklage-Ryannel and Johan Thelin. This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.<br/>
      Last updated on Nov 10, 2020.<br/>
    </p>
  </div>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46104829-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>